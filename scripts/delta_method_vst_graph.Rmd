---
title: "R Notebook"
output: html_notebook
---



```{r}
library(tidyverse)
library(tidylog)
```

```{r}
theme_set(cowplot::theme_cowplot())
```


```{r, fig.width=5, fig.height=3}
sqrt_pos <- 17
acosh_pos <- 16
log_pos <- 15

alpha <- 0.1

tibble(x = seq(0, 40, l = 1001)) %>%
  mutate(sqrt = 2 * sqrt(alpha * x),
         log = log(x + 1/(4*alpha)) + log(4 * alpha),
         acosh = acosh(2 * alpha * x + 1)) %>%
  ggplot(aes(x = x)) +
    geom_line(aes(y = sqrt), color = "#016FB9", size = 2) +
    geom_point(data = . %>% filter(x %% 1 == 0), aes(y = sqrt), color = "#016FB9", size = 2) +
    geom_line(aes(y = acosh), color = "#353531", size = 2) +
    geom_point(data = . %>% filter(x %% 1 == 0), aes(y = acosh), color = "#353531", size = 2) +
    geom_line(aes(y = log), color = "#EC4E20", size = 2) +
    geom_point(data = . %>% filter(x %% 1 == 0), aes(y = log), color = "#EC4E20", size = 2) +
    annotate(geom = "text", x = sqrt_pos + 0.2, y = 2 * sqrt(alpha * sqrt_pos), label = expression(s~sqrt(y)),
             hjust = 0, vjust = -0.4, size = 5, angle = 20) +
    annotate(geom = "text", x = acosh_pos, y = acosh(2 * alpha * acosh_pos + 1), label = expression(acosh(2~alpha~y+1)),
             hjust = 0, vjust = -0.2, size = 5, angle = 10) +
    annotate(geom = "text", x = log_pos, y = log(4  * alpha * log_pos + 1), label = expression(log(y+1/(4*alpha))+a),
             hjust = 0, vjust = 1.2, size = 5, angle = 8) +
    annotate(geom = "text", x = 28, y = 0.15, hjust = 1, vjust = 0, label = "y", size = 4, color = "darkgrey") +  
    annotate(geom = "text", x = 0.3, y = 3.7, hjust = 0, vjust = 1, label = "g(y)", size = 4, color = "darkgrey") +  
    coord_cartesian(ylim = c(0, 3.4), xlim = c(0, 28), clip = "off") +
    scale_y_continuous(expand = expansion(add = c(0, 0.3))) +
    scale_x_continuous(expand = expansion(0)) +
    theme(axis.title.x = element_blank(),
          axis.title.y = element_blank())
    # labs(y = "", x = "")

cowplot::save_plot("../output/graph_of_vsts.pdf", last_plot(), base_height = 3)
```




```{r, fig.width = 6, fig.height=4}
xg <- seq(2, 17, length.out = 1001)
f <- function(x){
  50 * x - 7 * (x-5)^2 + 0.5 * (x-3)^3 - 10 * x^1.4
}
f_deriv <- function(x){
  50 - 7 * 2 * (x-5) + 0.5 * 3 * (x-3)^2 - 10 * 1.4 * x^0.4
}
y <- f(xg)

min_x <- 2
min_y <- f(2)

plot(c(min_x-4, 17), y = c(min_y-200, f(17)), type = "n", xlab = "", ylab = "", xaxt = "n", yaxt = "n")


m1 <- 7
xg1 <- seq(m1-2, m1+2, length.out = 1001)
y_lin1 <- f(m1) - f_deriv(m1) * m1 + xg1 * f_deriv(m1)


m2 <- 14
xg2 <- seq(m2-2, m2+2, length.out = 1001)
y_lin2 <- f(m2) - f_deriv(m2) * m2 + xg2 * f_deriv(m2)


draws1 <- rnorm(n = 30, mean = m1, sd = 0.6)
draws2 <- rnorm(n = 30, mean = m2, sd = 0.6)
phantom_draws1 <- rnorm(n = 1e4, mean = m1, sd = 0.6)
phantom_draws2 <- rnorm(n = 1e4, mean = m2, sd = 0.6)

# Draw distribution lines
segments(x0 = draws1, y0 = min_y, x1 = draws1, y1 = f(draws1), col = scales::alpha("#8210b3", 0.1), lwd = 0.3)
segments(x0 = min_x, y0 = f(draws1), x1 = draws1, y1 = f(draws1), col = scales::alpha("#8210b3", 0.1), lwd = 0.3)
segments(x0 = draws2, y0 = min_y, x1 = draws2, y1 = f(draws2), col = scales::alpha("#8210b3", 0.1), lwd = 0.3)
segments(x0 = min_x, y0 = f(draws2), x1 = draws2, y1 = f(draws2), col = scales::alpha("#8210b3", 0.1), lwd = 0.3)


# Draw derivatives
lines(xg1, y_lin1, col = "#333333", lwd = 5)
lines(xg2, y_lin2, col = "#333333", lwd = 5)

# Draw main lines
lines(xg, y, type = "l", col = "#ad1c0c", lwd = 5)

# Draw approx points
points(m1, f(m1), pch = 16)
points(m2, f(m2), pch = 16)


# draw bottom dens
out_dens1 <- density(phantom_draws1, adjust = 3, from = m1 - 3, to = m1 + 3)
lines(out_dens1$x, min_y-out_dens1$y * 150, lwd = 2, col = "#8210b3")
out_dens2 <- density(phantom_draws2, adjust = 3, from = m2 - 3, to = m2 + 3)
lines(out_dens2$x, min_y-out_dens2$y * 150, lwd = 2, col = "#8210b3")

# draw left dens
out_dens3 <- density(f(phantom_draws1), adjust = 3, from = 150, to = 240)
lines(min_x-out_dens3$y * 50, y = out_dens3$x, lwd = 2, col = "#8210b3")
out_dens4 <- density(f(phantom_draws2), adjust = 3, from = 260, to = 550)
lines(min_x-out_dens4$y * 50, y = out_dens4$x, lwd = 2, col = "#8210b3")

# draw left according to delta
theo_g1 <- seq(150, 240, length.out = 1001)
theo1 <- dnorm(theo_g1, mean = f(m1), sd = f_deriv(m1) * 0.6)
lines(min_x-theo1 * 50, theo_g1, lwd = 2, col = scales::alpha("black", 1), lty = "dotted")
theo_g2 <- seq(260, 550, length.out = 1001)
theo2 <- dnorm(theo_g2, mean = f(m2), sd = f_deriv(m2) * 0.6)
lines(min_x-theo2 * 50, theo_g2, lwd = 2, col = scales::alpha("black", 1), lty = "dotted")

# axis(1, at=, labels=, pos=0, lty=, col=, las=, tck=)
segments(x0 = min_x, y0 = min_y, x1 = 17, y1 = min_y)
segments(x0 = min_x, y0 = min_y, x1 = min_x, y1 = 700)



```



# Session Info

```{r}
sessionInfo()
```


