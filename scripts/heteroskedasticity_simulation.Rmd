---
title: "R Notebook"
output: html_notebook
---


```{r}
library(tidyverse)
```


```{r}
cross_df(list(x = seq(0, 104), mu = c(4, 16, 64))) %>%
  mutate(density = dpois(x, lambda = mu)) %>%
  ggplot(aes(x = x + 0.5, y = density, fill = as.factor(mu)))+
    # geom_histogram(position = "identity", alpha = 0.8, breaks = seq(-1, 101) + 0.5) +
    geom_col(position = "identity", alpha = 0.8) +
    geom_vline(xintercept = c(4, 16, 64)) +
    scale_y_continuous(expand = expansion(mult = c(0, 0.05))) +
    scale_x_continuous(breaks = seq(0, 100, by = 25), expand = expansion(add = c(0.5, 0))) +
    guides(fill = "none") +
    labs(x = "Counts", y = "") +
    cowplot::theme_cowplot() +
    theme(axis.line.y = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank())



cowplot::save_plot("../output/heteroskedasticity/hists.pdf", last_plot())
```

```{r}
cross_df(list(k1 = seq(0, 105), k2 = seq(0, 105), mu1 = c(4, 16, 64), mu2 = c(16, 64)) ) %>%
  filter(log2(mu2 / mu1) == 2) %>%
  mutate(p1 = dpois(k1, lambda = mu1),
         p2 = dpois(k2, lambda = mu2)) %>%
  mutate(lfc = log2(k2 / k1), prob = p1 * p2) %>%
  filter(! is.na(lfc)  & ! is.infinite(lfc)) %>%
  group_by(mu1, mu2) %>%
  summarize(density = dplyr::rename(as_tibble(density(lfc, weights = prob)[c("x", "y")]), lfc = x, dens = y),
            .groups = "drop") %>%
  unpack(density) %>%
  mutate(label_pos = ifelse(mu1 == 4, 1, 1.7)) %>%
  ggplot(aes(x = label_pos, y = lfc)) +
    geom_hline(yintercept = 2) +
    geom_vline(xintercept = c(1, 1.7), color = "darkgrey", size = 0.3) +
    geom_path(aes(x = label_pos + dens / 1.8, group = label_pos), size = 1.3) +
    coord_cartesian(ylim = c(-1, 5), xlim = c(0.8, 2.8)) +
    scale_x_continuous(breaks = numeric(0), expand = expansion(0)) +
    guides(fill = "none") +
    labs(x = "", y = expression(log[2]~Fold~Change~Estimate)) +
    cowplot::theme_cowplot() +
    theme(axis.line.x = element_blank())

cowplot::save_plot("../output/heteroskedasticity/log_fold_change.pdf", last_plot(), )  
```

The actual figure was arranged using Illustrator.



# Session Info

```{r}
sessionInfo()
```